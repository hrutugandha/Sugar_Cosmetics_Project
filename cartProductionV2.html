<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="cart.css">
</head>
<body>
    <!--------------Header--------------->
    <div id="header-container">
        <div id="header">
            <div class="logo">
                <img src="//in.sugarcosmetics.com/desc-images/SUGARLogo.png" alt="">
            </div>
            <div class="searchbar">
                <input class="search_input" type="text" name="" placeholder="Try &quot;Liquid Lipstick&quot;" value="">
                <a href="https://cdn-icons.flaticon.com/png/512/2811/premium/2811790.png?token=exp=1642505397~hmac=65ce7d4e825bb56d1dd524c195208a85" class="search_icon">Search</a>
              </div>
            <div class="login_btn">
                <img src="https://t4.ftcdn.net/jpg/00/65/77/27/240_F_65772719_A1UV5kLi5nCEWI0BNLLiFaBPEkUbv5Fv.jpg" alt="">
                <u>Login/Sign-up</u>
            </div>
            <div class="cute_btn">
                <img src="https://cdn-icons-png.flaticon.com/128/1077/1077086.png" alt="" placeholder="Wishlist">
                <img src="https://cdn-icons-png.flaticon.com/512/726/726564.png" alt="" placeholder="cart">
                <img src="https://cdn-icons-png.flaticon.com/512/879/879859.png" alt="" placeholder="Discount">
            </div>
        </div>
        <div id="dropdown_container">
          <div class="dropdown_menu">
            <div style="margin-left: 25px;"> MAKEUP</div>
            <div> BRUSHES</div>
            <div>SKINCARE</div>
            <div>TRENDING</div>
            <div>BLOG</div>
            <div>OFFERS</div>
          </div>
        </div>
    </div>
         <!--------------Header-end--------------->

    <!---------- Cart Page Start ------------->
    <!-- left Portion -->
    <div id="cart-container">
        <div class="cart-left">
            <div class="cart_order_summary">
                <div class="smry-box">
                    <div class="smry-disp">
                        <div class="smry-logo">
                            <img src="https://in.sugarcosmetics.com/desc-images/shopping_cart.svg" width="20px" height="20px" class="" alt="">
                        </div>
                        <div class="smry-txt">Order Summary</div>
                    </div>
                    <div class="smry-cart-total">Card Total : 10000</div>
                </div>
                <div class="cart-product">
                    <div>
                        
                    </div>
                    
                    <div class="product-spec"></div>
                </div>
            </div>
        </div>
        <div class="cart-right">
            <p>HELLO</p>
            
        </div>
    </div>

</body>
</html>
<script src="https://kit.fontawesome.com/74404664ae.js" crossorigin="anonymous"></script>
<script>
    
    //Start
    
    //Local Stogare Key: makeupData
    var cartArr = JSON.parse(localStorage.getItem("makeupData"))||[];
    console.log("Cart: ",cartArr);
     displayCart(cartArr);

//     window.addEventListener("load", function () {
//         displayCart(cartArr);
//   });

    function displayCart(cartArr){
        document.querySelector(".cart-product").innerHTML="";
        cartArr.map(function (data,index){
        var div = document.createElement("div");
        
        //Image Creation
        var image = document.createElement("img");
        image.setAttribute ("src",data.image_url)

        //Name Creation
        var name = document.createElement("p");
        name.textContent = data.name;

        //Image & Name in one div;
        var divImgName = document.createElement("div");
        divImgName.append(image,name)

        //Price Creation

        var price = document.createElement("p");
        price.textContent = data.price;
        

        //Increment/Decrement Added Product Creation
        var divBox = document.createElement("div");
        divBox.id = "divBox"
        var divRmv = document.createElement("div");
        divRmv.id="divRmv";
        divRmv.innerHTML='<i class="fas fa-trash"></i>';
        var divDec = document.createElement("div");
        divDec.id="divDec";
        divDec.innerHTML='<i class="fas fa-minus-circle"></i>'
        var divQty = document.createElement("div");
        divQty.id="divQty";
        divQty.textContent= data.count;
        var divInc = document.createElement("div");
        divInc.id="divInc";
        divInc.innerHTML='<i class="fas fa-plus-circle"></i>'

        var divPriceBox = document.createElement("div");
        divPriceBox.id="divPriceBox";
    
        //Append to divBox
        divBox.append(divRmv,divDec,divQty,divInc,divPriceBox);
        
        var divQtyP = document.createElement("div");
        divQtyP.id ="divQtyP";
        divQtyP.textContent=data.count;

        var divMul = document.createElement("div");
        divMul.id ="divMul";
        divMul.textContent="x";

        var divPrice = document.createElement("div");
        divPrice.id ="divPrice";
        divPrice.textContent=data.price;

        var divEqual = document.createElement("div");
        divEqual.id ="=";
        divEqual.textContent="=";

        var divPTotal = document.createElement("div");
        divPTotal.id ="divPTotal";
        divPTotal.textContent = data.price * data.count;

        //Append to divPriceBox
        divPriceBox.append(divQtyP,divMul,divPrice,divEqual,divPTotal)
       

        //Append to div
        div.append(divImgName,divBox);
        document.querySelector(".cart-product").append(div);

        
        //Remove Creation
        // var remove = document.createElement("p");
        // remove.textContent = "Remove"
        divRmv.addEventListener("click",function(){
            removeItem(index);
        });

        //Increment function Call 
        divInc.addEventListener("click",function(){
            incrementProduct(index);
        });

        //Decreement function Call 
        divDec.addEventListener("click",function(){
            decrementProduct(index);
        });
    });
}

    
     //Total calculate
     var total = cartArr.reduce(function(acc,cv){
        return (acc + cv.price*cv.count);
    },0);
    localStorage.setItem("total",total);

    console.log("Total: ",total);

    document.querySelector("#total").textContent=`Cart Total : ${total} `
    
    //Coupon Apply
    document.querySelector("#cart-total").textContent=total;
    localStorage.setItem("discountPrice",0);

    var discPrice = JSON.parse(localStorage.getItem("discountPrice"));

    //Check didcount =0
    if(discPrice==0){
        document.querySelector("#disc-applied").textContent=0;
        document.querySelector("#pay-amount").textContent=total;
    }

    document.querySelector("form").addEventListener("submit", discount);
     //Apply Discount
     function discount(event){
        event.preventDefault(); 
        var coupon = document.querySelector("#coupon").value;
        if(coupon=='masai30'){
            var discountPrice = total * 0.7;

            localStorage.setItem("discountPrice",discountPrice);
            document.querySelector("#disc-applied").textContent=total*0.3;
            document.querySelector("#pay-amount").textContent=discountPrice;

            console.log("discount:",discountPrice);
        }
        else{
            document.querySelector("#invalid-coupon").textContent="Invalid Coupon";
        }
        
       
    }

   

    //Redirect to payment page
    document.getElementById("checkOut").addEventListener("click",checkOut);
    function checkOut(event){
        if(event==true){
            window.location.href = "payment.html"
        }
        else{
            alert("Cart Empty");
        }
        
    }
   


 //Remove From Cart
 function removeItem(index){
    event.preventDefault();
         console.log(index);

         total = JSON.parse(localStorage.getItem("total"));
         var newTotal=total-cartArr[index].price;
         localStorage.setItem("total",newTotal);

         cartArr.splice(index,1);
        // console.log(cartArr);
         localStorage.setItem("makeupData",JSON.stringify(cartArr));
        //  var cartArrRemove = JSON.parse(localStorage.getItem("makeupData"));
         console.log(cartArr)
         displayCart(cartArr);
         
         console.log(newTotal);
         
         document.querySelector("#total").textContent=`Cart Total : ${newTotal} `
         document.querySelector("#cart-total").textContent=newTotal;
         document.querySelector("#pay-amount").textContent=newTotal;
         //console.log("Aftet Rem Total: ",newTotal);
         
        //  cartArr.map(function (data,index){
        //      document.querySelector("")
        //  })
     }

     //Increment Product
     function incrementProduct(index){
        event.preventDefault();

        var newCount= ++cartArr[index].count;
        console.log(newCount)
        localStorage.setItem("makeupData",JSON.stringify(cartArr));

        //Update Quantiity when incremented
        var x = document.querySelectorAll("#divQty");
        x[index].textContent=newCount;

       //Update Quantiity to on when incremented(On divPriceBox)
        var y = document.querySelectorAll("#divQtyP");
        y[index].textContent=newCount;

        //Uodate Total Price when increment Product
        var z = document.querySelectorAll("#divPTotal");
        z[index].textContent = cartArr[index].price * cartArr[index].count

        //Update Card Total
        total +=  cartArr[index].price;
        console.log("Total after inc. ",total)
        localStorage.setItem("total",total);
        document.querySelector("#total").textContent=`Cart Total : ${total} `;
        document.querySelector("#cart-total").textContent=total;
        document.querySelector("#pay-amount").textContent=total;
        

     }
     
     //Decrement Product
     function decrementProduct(index){
        event.preventDefault();
        count=cartArr[index].count;
        if(count==1){
            removeItem(index);
        }
        else{
            var newCount=--cartArr[index].count;
            localStorage.setItem("makeupData",JSON.stringify(cartArr));

             //Update Quantiity when incremented
            var x = document.querySelectorAll("#divQty");
            x[index].textContent=newCount;
            console.log(newCount)

            //Update Quantiity to on when Decrement(On divPriceBox)
            var y = document.querySelectorAll("#divQtyP");
            y[index].textContent=newCount;

    
            //Uodate Total Price when Decrement Product
            var z = document.querySelectorAll("#divPTotal");
            z[index].textContent = cartArr[index].price * cartArr[index].count
            //Update Card Total
            total -=  cartArr[index].price;
            console.log("Total after dec. ",total)
            localStorage.setItem("total",total);
            document.querySelector("#total").textContent=`Cart Total : ${total} `;
            document.querySelector("#cart-total").textContent=total;
            document.querySelector("#pay-amount").textContent=total;
        
        }
        
     }
    

</script>